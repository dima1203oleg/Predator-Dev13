apiVersion: litmuschaos.io/v1alpha1
kind: ChaosExperiment
metadata:
  name: pod-delete-experiment
  namespace: litmus
spec:
  definition:
    scope: cluster
    target:
      kind: pod
      labelSelector:
        # Generic label selector, adjust as needed for your application components
        # Example: app.kubernetes.io/component: api
        # Or target specific applications deployed by ArgoCD
        # app.kubernetes.io/instance: <your-argocd-app-name>
        # For now, we'll keep it broad for demonstration
        app.kubernetes.io/part-of: predator-analytics
    steps:
      - name: pod-delete
        probe:
          - name: check-app-health
            type: http
            http:
              url: "http://predator-umbrella-api.default.svc.cluster.local:8080/health" # Placeholder URL, replace 'default' with actual namespace if needed
              method: GET
              status: 200
            interval: 5s
            timeout: 10s
        action: delete
        duration: 30s
        criteria:
          - type: count
            value: 1
          - type: label
            key: app.kubernetes.io/component
            value: api # Target API pods for this example
---
apiVersion: litmuschaos.io/v1alpha1
kind: ChaosEngine
metadata:
  name: predator-api-pod-delete
  namespace: litmus
spec:
  engineState: "active" # "active" or "stop"
  chaosServiceAccount: litmus-admin
  experiments:
    - name: pod-delete-experiment
      spec:
        components:
          experimentImage: litmuschaos/go-runner
          experimentImageTag: latest
          env:
            - name: TOTAL_CHAOS_DURATION
              value: "30" # in seconds
            - name: CHAOS_INTERVAL
              value: "10" # in seconds
            - name: FORCE
              value: "true"
