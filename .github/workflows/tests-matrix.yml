name: Tests (matrix)

on:
    pull_request:
        branches: [main]
    push:
        branches: [main]

jobs:
    pytest-matrix:
        name: pytest on Python ${{ matrix.python-version }}
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: [3.10, 3.11]
        steps:
            - uses: actions/checkout@v4
            - name: Set up Python
              uses: actions/setup-python@v6
              with:
                  python-version: ${{ matrix.python-version }}
            - name: Install dependencies
              run: |
                  python -m pip install -U pip
                  pip install -r requirements-dev.txt
                        - name: Run linters (ruff) and tests
                            run: |
                                    ruff check --fix . || true
                                    ruff format --check . || true
                                    # Run pytest and emit JUnit XML so the job can upload results
                                    pytest -q --maxfail=1 --junitxml=junit.xml
            - name: Upload test results (junit)
              if: always()
              uses: actions/upload-artifact@v4
              with:
                  name: pytest-report-${{ matrix.python-version }}
                  path: ./junit.xml
